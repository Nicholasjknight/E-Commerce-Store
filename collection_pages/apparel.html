<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apparel Collection</title>
    <link rel="stylesheet" href="../style.css"> <!-- Adjusted path -->
    <link rel="icon" href="../images/Man Kave Text.png" type="image/x-icon"> <!-- Adjusted path -->
    <script src="../env.js"></script> <!-- Adjusted path -->
    <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.31/default/snipcart.css" />
    <script async src="https://cdn.snipcart.com/themes/v3.0.31/default/snipcart.js"></script>
</head>
<body>
    <!-- Snipcart container with dynamic API key -->
    <div hidden id="snipcart" data-api-key=""></div>

    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <h1>Apparel Collection</h1>
    <div id="catalog-container" class="catalog-grid"></div>

    <!-- Footer Placeholder -->
    <div id="footer-placeholder"></div>

    <!-- Initialization Script -->
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            console.log("DOM fully loaded and parsed for Apparel Collection.");
    
            // Snipcart Initialization
            const snipcartDiv = document.getElementById("snipcart");
            const apiKey = window.env?.SNIPCART_API_KEY || "";
            if (apiKey) {
                snipcartDiv.setAttribute("data-api-key", apiKey);
                console.log("Snipcart API key applied:", apiKey);
            } else {
                console.error("Snipcart API key missing. Check env.js or fallback.");
                return;
            }
    
            // Snipcart readiness
            document.addEventListener("snipcart.ready", () => {
                console.log("Snipcart is ready!");
                if (typeof initializeCartUI === "function") {
                    initializeCartUI(); // Call centralized function from script.js
                } else {
                    console.error("initializeCartUI function not found.");
                }
            });
    
            // Load and Render Products for the Apparel Collection
            const { loadProducts, renderProducts } = await import('../render_products.js'); // Adjusted path
            const products = await loadProducts();
    
            const category = 'Apparel'; // Adjust the category dynamically if needed
            const filteredProducts = products.filter(product =>
                product.category && product.category.includes(category)
            );
    
            renderProducts(filteredProducts, 'catalog-container');
    
            // Load Header and Footer
            await loadHeaderAndFooter();
        });
    
        async function loadHeaderAndFooter() {
            try {
                const headerResponse = await fetch('../header.html'); // Adjusted path
                const headerHtml = await headerResponse.text();
                document.getElementById('header-placeholder').innerHTML = headerHtml;
    
                const footerResponse = await fetch('../footer.html'); // Adjusted path
                const footerHtml = await footerResponse.text();
                document.getElementById('footer-placeholder').innerHTML = footerHtml;
    
                // Initialize cart updates in the header after loading
                if (typeof initializeCartUI === "function") {
                    initializeCartUI(); // Call centralized function for cart updates
                }
            } catch (error) {
                console.error('Error loading header or footer:', error);
            }
        }
    </script>
    

    <!-- Additional Scripts -->
    <script defer src="../script.js"></script> <!-- Adjusted path -->
    <script defer src="../account.js"></script> <!-- Adjusted path -->
    <script src="../search.js"></script>

</body>
</html>
